<!DOCTYPE html>
<html>
  <head>
    <title>Tiny stories</title>
    <link href='http://fonts.googleapis.com/css?family=Libre+Baskerville' rel='stylesheet' type='text/css'>
    <link href="css/style.css" rel="stylesheet">
  </head>
  <body>
    <div id="story"></div>
    <hr>
    <a href=# id="love-another">Tell me another love story.</a>
    <a href=# id="love-switch">Don't tell me a love story!</a>
    <a href=# id="notlove-another">Tell me another story.</a>
    <a href=# id="notlove-switch">I'd rather read a love story!</a>
    <script src="lib/markdown.js"></script>
    <script>
      var story = document.getElementById( "story" );
      var stories = {};
      var loveAnotherButton = document.getElementById( "love-another" );
      var loveSwitchButton = document.getElementById( "love-switch" );
      var notloveAnotherButton = document.getElementById( "notlove-another" );
      var notloveSwitchButton = document.getElementById( "notlove-switch" );

      var type = "love";
      function setType( t ) {
        if ( t === "love" ) {
          type = "love";
          loveAnotherButton.style.display = "block";
          loveSwitchButton.style.display = "block";
          notloveAnotherButton.style.display = "none";
          notloveSwitchButton.style.display = "none";
        } else if ( t === "notlove" ) {
          type = "notlove";
          loveAnotherButton.style.display = "none";
          loveSwitchButton.style.display = "none";
          notloveAnotherButton.style.display = "block";
          notloveSwitchButton.style.display = "block";
        }
      };

      setType( "love" );

      function loadStoryList() {
        var req = new XMLHttpRequest();
        req.onload = function() {
          stories = JSON.parse( this.responseText );
          loadRandomStory();
        };
        req.open( "GET", "stories.json", true );
        req.send();
      };
      loadStoryList();

      function loadStory( storyName ) {
        var req = new XMLHttpRequest();
        req.onload = function() {
          story.innerHTML = markdown.toHTML( this.responseText );
        };
        req.open( "GET", storyName, true );
        req.send();
      };

      function loadRandomStory() {
        var storyName = stories[type][Math.floor( Math.random() * stories[type].length )];
        loadStory( type + "/" + storyName );
      };

      loveAnotherButton.addEventListener( "click", function() {
        loadRandomStory();
      } );

      notloveAnotherButton.addEventListener( "click", function() {
        loadRandomStory();
      } );

      loveSwitchButton.addEventListener( "click", function() {
        setType( "notlove" );
        loadRandomStory();
      } );

      notloveSwitchButton.addEventListener( "click", function() {
        setType( "love" );
        loadRandomStory();
      } );
    </script>
  </body>
</html>
